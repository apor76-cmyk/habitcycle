<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Daily Pencil Journal Pro</title>

<style>
:root{
    --bg:#f1f5f9;
    --card:#ffffff;
    --line:rgba(0,0,0,0.1);
    --accent:#6366f1;
    --text:#111;
}
body.dark{
    --bg:#0f172a;
    --card:#1e293b;
    --line:rgba(255,255,255,0.12);
    --text:#e5e7eb;
}
body{
    margin:0;
    background:var(--bg);
    font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
    color:var(--text);
    overflow:hidden;
}

/* layout */
.app{display:flex;height:100vh}

/* sidebar */
.sidebar{
    width:260px;
    background:var(--card);
    border-right:1px solid var(--line);
    padding:15px;
    overflow:auto;
}
.noteItem{
    padding:8px;
    border-radius:8px;
    cursor:pointer;
}
.noteItem:hover{background:rgba(99,102,241,0.1)}

/* main */
.main{flex:1;display:flex;flex-direction:column}

/* toolbar */
.toolbar{
    background:var(--card);
    border-bottom:1px solid var(--line);
    padding:8px;
    display:flex;
    gap:6px;
    align-items:center;
    flex-wrap:wrap;
}
button{
    padding:6px 10px;
    border-radius:8px;
    border:none;
    background:var(--accent);
    color:#fff;
    font-size:13px;
}

/* page area */
.pageArea{flex:1;position:relative}

textarea{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:120px;
    border:none;
    border-bottom:1px solid var(--line);
    resize:none;
    padding:10px;
    font-size:16px;
    background:transparent;
    color:var(--text);
}

canvas{
    position:absolute;
    top:120px;
    left:0;
    touch-action:none;
}
</style>
</head>
<body>

<div class="app">

<div class="sidebar">
<h3>ğŸ“š ê¸°ë¡</h3>
<input type="date" id="datePicker" onchange="openDate(this.value)">
<div id="list"></div>
</div>

<div class="main">

<div class="toolbar">
<button onclick="addPage()">í˜ì´ì§€+</button>
<button onclick="deletePage()">ì‚­ì œ</button>
<button onclick="setPen()">íœ</button>
<button onclick="setHighlighter()">í˜•ê´‘íœ</button>
<button onclick="setEraser()">ì§€ìš°ê°œ</button>
<button onclick="backup()">ë°±ì—…</button>
<input type="file" onchange="restore(event)">
<button onclick="toggleDark()">ğŸŒ™</button>
<span id="pageLabel"></span>
</div>

<div class="pageArea">
<textarea id="text"></textarea>
<canvas id="canvas"></canvas>
</div>

</div>
</div>

<script>
let db=JSON.parse(localStorage.getItem("journalDB")||"{}")
let currentDate=new Date().toISOString().slice(0,10)
let pageIndex=0

const canvas=document.getElementById("canvas")
const ctx=canvas.getContext("2d")

let tool="pen"
let drawing=false
let lastX=0,lastY=0

function resize(){
    canvas.width=window.innerWidth-260
    canvas.height=window.innerHeight-160
    loadPage()
}
window.addEventListener("resize",resize)

function saveDB(){localStorage.setItem("journalDB",JSON.stringify(db))}

/* tools */
function setPen(){tool="pen"}
function setHighlighter(){tool="highlighter"}
function setEraser(){tool="eraser"}

/* date */
function openDate(date){
    currentDate=date
    if(!db[currentDate]) db[currentDate]=[]
    pageIndex=0
    renderList()
    loadPage()
}

/* page */
function addPage(){
    if(!db[currentDate]) db[currentDate]=[]
    db[currentDate].push({text:"",draw:null})
    pageIndex=db[currentDate].length-1
    saveDB();renderList();loadPage()
}

function deletePage(){
    if(!db[currentDate]) return
    db[currentDate].splice(pageIndex,1)
    pageIndex=0
    saveDB();renderList();loadPage()
}

function loadPage(){
    const pages=db[currentDate]||[]
    if(!pages.length){addPage();return}

    const p=pages[pageIndex]
    document.getElementById("pageLabel").innerText=`${currentDate} - ${pageIndex+1}/${pages.length}`

    document.getElementById("text").value=p.text||""

    ctx.clearRect(0,0,canvas.width,canvas.height)
    if(p.draw){
        const img=new Image()
        img.onload=()=>ctx.drawImage(img,0,0)
        img.src=p.draw
    }
}

function savePage(){
    const pages=db[currentDate]
    if(!pages) return
    pages[pageIndex].text=document.getElementById("text").value
    pages[pageIndex].draw=canvas.toDataURL()
    saveDB()
}

document.getElementById("text").addEventListener("input",savePage)

/* drawing */
function getPos(e){
    const rect=canvas.getBoundingClientRect()
    return {x:e.clientX-rect.left,y:e.clientY-rect.top}
}

canvas.addEventListener("pointerdown",e=>{
    if(e.pointerType==="touch") return
    canvas.setPointerCapture(e.pointerId)
    drawing=true
    const p=getPos(e)
    lastX=p.x
    lastY=p.y
})

canvas.addEventListener("pointermove",e=>{
    if(!drawing) return
    const p=getPos(e)

    ctx.lineCap="round"
    ctx.lineJoin="round"

    const pressure=e.pressure>0?e.pressure:0.5

    if(tool==="pen"){
        ctx.globalAlpha=1
        ctx.strokeStyle="#111"
        ctx.lineWidth=pressure*4+1
        ctx.globalCompositeOperation="source-over"
    }

    if(tool==="highlighter"){
        ctx.globalAlpha=0.3
        ctx.strokeStyle="#facc15"
        ctx.lineWidth=20
        ctx.globalCompositeOperation="source-over"
    }

    if(tool==="eraser"){
        ctx.globalCompositeOperation="destination-out"
        ctx.lineWidth=20
    }

    ctx.beginPath()
    ctx.moveTo(lastX,lastY)
    ctx.lineTo(p.x,p.y)
    ctx.stroke()

    lastX=p.x
    lastY=p.y
})

canvas.addEventListener("pointerup",e=>{
    drawing=false
    canvas.releasePointerCapture(e.pointerId)
    ctx.globalAlpha=1
    ctx.globalCompositeOperation="source-over"
    savePage()
})

canvas.addEventListener("pointercancel",()=>drawing=false)

/* list */
function renderList(){
    const list=document.getElementById("list")
    list.innerHTML=""
    Object.keys(db).sort().reverse().forEach(d=>{
        const div=document.createElement("div")
        div.className="noteItem"
        div.innerText=d+" ("+db[d].length+")"
        div.onclick=()=>openDate(d)
        list.appendChild(div)
    })
}

/* backup */
function backup(){
    const blob=new Blob([JSON.stringify(db)],{type:"application/json"})
    const a=document.createElement("a")
    a.href=URL.createObjectURL(blob)
    a.download="journal-backup.json"
    a.click()
}
function restore(e){
    const file=e.target.files[0]
    const reader=new FileReader()
    reader.onload=()=>{
        db=JSON.parse(reader.result)
        saveDB()
        renderList()
        openDate(currentDate)
    }
    reader.readAsText(file)
}

function toggleDark(){document.body.classList.toggle("dark")}

/* init */
resize()
renderList()
openDate(currentDate)
</script>

</body>
</html>
