<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Daily Pencil Journal</title>

<style>
:root{
    --bg:#f1f5f9;
    --card:#ffffff;
    --line:rgba(0,0,0,0.1);
    --accent:#6366f1;
    --text:#111;
}
body.dark{
    --bg:#0f172a;
    --card:#1e293b;
    --line:rgba(255,255,255,0.12);
    --text:#e5e7eb;
}
body{
    margin:0;
    background:var(--bg);
    font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
    color:var(--text);
}

/* ë ˆì´ì•„ì›ƒ */
.app{
    display:flex;
    height:100vh;
}

/* ì‚¬ì´ë“œë°” */
.sidebar{
    width:260px;
    background:var(--card);
    border-right:1px solid var(--line);
    padding:15px;
    overflow:auto;
}
.sidebar h3{margin-top:0}

.noteItem{
    padding:8px;
    border-radius:8px;
    cursor:pointer;
}
.noteItem:hover{
    background:rgba(99,102,241,0.1);
}

/* ë©”ì¸ */
.main{
    flex:1;
    display:flex;
    flex-direction:column;
}

/* íˆ´ë°” */
.toolbar{
    background:var(--card);
    border-bottom:1px solid var(--line);
    padding:10px;
    display:flex;
    gap:8px;
    align-items:center;
}

button,input{
    padding:8px 12px;
    border-radius:8px;
    border:1px solid var(--line);
}

button{
    background:var(--accent);
    color:#fff;
    border:none;
}

/* í˜ì´ì§€ ì˜ì—­ */
.pageArea{
    flex:1;
    position:relative;
}

/* í…ìŠ¤íŠ¸ */
textarea{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:120px;
    border:none;
    border-bottom:1px solid var(--line);
    resize:none;
    padding:10px;
    font-size:16px;
    background:transparent;
    color:var(--text);
}

/* ìº”ë²„ìŠ¤ */
canvas{
    position:absolute;
    top:120px;
    left:0;
}
</style>
</head>
<body>

<div class="app">

<div class="sidebar">
<h3>ğŸ“š ê¸°ë¡</h3>
<input type="date" id="datePicker" onchange="openDate(this.value)">
<div id="list"></div>
</div>

<div class="main">

<div class="toolbar">
<button onclick="addPage()">í˜ì´ì§€ ì¶”ê°€</button>
<button onclick="deletePage()">ì‚­ì œ</button>
<button onclick="backup()">ë°±ì—…</button>
<input type="file" onchange="restore(event)">
<button onclick="toggleDark()">ğŸŒ™</button>
<span id="pageLabel"></span>
</div>

<div class="pageArea">
<textarea id="text"></textarea>
<canvas id="canvas"></canvas>
</div>

</div>
</div>

<script>
let db=JSON.parse(localStorage.getItem("journalDB")||"{}")
let currentDate=new Date().toISOString().slice(0,10)
let pageIndex=0

const canvas=document.getElementById("canvas")
const ctx=canvas.getContext("2d")

function resize(){
    canvas.width=window.innerWidth-260
    canvas.height=window.innerHeight-160
    loadPage()
}
window.addEventListener("resize",resize)

function saveDB(){
    localStorage.setItem("journalDB",JSON.stringify(db))
}

/* ë‚ ì§œ ì—´ê¸° */
function openDate(date){
    currentDate=date
    if(!db[currentDate]) db[currentDate]=[]
    pageIndex=0
    renderList()
    loadPage()
}

/* í˜ì´ì§€ ì¶”ê°€ */
function addPage(){
    if(!db[currentDate]) db[currentDate]=[]
    db[currentDate].push({text:"",draw:null})
    pageIndex=db[currentDate].length-1
    saveDB()
    renderList()
    loadPage()
}

/* í˜ì´ì§€ ì‚­ì œ */
function deletePage(){
    if(!db[currentDate]) return
    db[currentDate].splice(pageIndex,1)
    pageIndex=0
    saveDB()
    renderList()
    loadPage()
}

/* í˜ì´ì§€ ë¡œë“œ */
function loadPage(){
    const pages=db[currentDate]||[]
    if(!pages.length){addPage();return}

    const p=pages[pageIndex]
    document.getElementById("pageLabel").innerText=`${currentDate} - ${pageIndex+1}/${pages.length}`

    document.getElementById("text").value=p.text||""

    ctx.clearRect(0,0,canvas.width,canvas.height)
    if(p.draw){
        const img=new Image()
        img.onload=()=>ctx.drawImage(img,0,0)
        img.src=p.draw
    }
}

/* ì €ì¥ */
function savePage(){
    const pages=db[currentDate]
    if(!pages) return
    pages[pageIndex].text=document.getElementById("text").value
    pages[pageIndex].draw=canvas.toDataURL()
    saveDB()
}

document.getElementById("text").addEventListener("input",savePage)

/* í•„ê¸° */
let drawing=false
canvas.addEventListener("pointerdown",e=>{
    drawing=true
    ctx.beginPath()
    ctx.moveTo(e.offsetX,e.offsetY)
})
canvas.addEventListener("pointermove",e=>{
    if(!drawing) return
    ctx.lineWidth=(e.pressure||0.5)*4+1
    ctx.lineTo(e.offsetX,e.offsetY)
    ctx.stroke()
})
canvas.addEventListener("pointerup",()=>{drawing=false;savePage()})
canvas.addEventListener("pointerleave",()=>drawing=false)

/* ëª©ë¡ */
function renderList(){
    const list=document.getElementById("list")
    list.innerHTML=""
    Object.keys(db).sort().reverse().forEach(d=>{
        const div=document.createElement("div")
        div.className="noteItem"
        div.innerText=d+" ("+db[d].length+")"
        div.onclick=()=>openDate(d)
        list.appendChild(div)
    })
}

/* ë°±ì—… */
function backup(){
    const blob=new Blob([JSON.stringify(db)],{type:"application/json"})
    const a=document.createElement("a")
    a.href=URL.createObjectURL(blob)
    a.download="journal-backup.json"
    a.click()
}

function restore(e){
    const file=e.target.files[0]
    const reader=new FileReader()
    reader.onload=()=>{
        db=JSON.parse(reader.result)
        saveDB()
        renderList()
        openDate(currentDate)
    }
    reader.readAsText(file)
}

function toggleDark(){document.body.classList.toggle("dark")}

/* ì´ˆê¸° */
resize()
renderList()
openDate(currentDate)
</script>

</body>
</html>
